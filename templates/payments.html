{% extends "base.html" %}

{% block content %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.5/jspdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/handsontable/dist/handsontable.full.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/handsontable/dist/handsontable.full.min.css" />

    <title>charting python</title>
</head>
<body>
    <div class="navbar navbar-default visible-xs">
        <div class="container-fluid">
          <button class="btn btn-default navbar-btn" data-toggle="collapse" data-target="#filter-sidebar">
            <i class="fa fa-tasks"></i> Choose Customers
          </button>
        </div>
    </div>
      
    <div class="container-fluid">
      
        <div class="row">
      
          <!-- filter sidebar -->
            <div id="filter-sidebar" class="col-xs-6 col-sm-3 visible-sm visible-md visible-lg collapse sliding-sidebar">

                <form method="GET">
                    <div id="group-1">
                        {% for k, v in sold_objs.items %}
                        <div class="form-check">
                            <label class="form-check-label">
                            <input type="checkbox" class="form-check-input" name="boxes" value="">{{ k }}
                            </label>
                        </div>    
                        {% endfor %}
                    </div>    
                    <button type="submit" class="btn btn-primary">Submit</button>
                    <script>
                        console.log("It's happening")
                        console.log(document.getElementsByClassName("list-group-item"))
                    </script>
                </form>
            </div>
            <!-- table container -->
            <div class="col-sm-9">
        
                <div class="card">
                    <br>
                    <div>
                        <div id="myHandsomeTable"></div>
                    </div>
                    <br>
                    <button onclick="saveAsPDF();" class="btn btn-primary">save as pdf</button>
                </div>
                <a href="{% url 'post_new' %}" class="top-menu">
                    {% include './icons/file-earmark-plus.svg' %}
                </a>
            </div>
        </div>
      
    </div>

    <script>
        
    const json_data = {{json_data|safe}};
    //const raw_data = {{raw_data|safe}};
    const labels = {{labels|safe}};
    const colors = [
                'rgba(134, 99, 132, 0.5)',
                'rgba(154, 162, 235, 0.5)',
                'rgb(60, 179, 113, 0.5)',
                'rgba(25, 206, 86, 0.6)',
                'rgba(45, 192, 192, 0.2)',
                'rgba(253, 102, 255, 0.6)',
                'rgba(155, 159, 64, 0.2)',
                'rgba(70, 60, 35, 0.4)'
            ]
    const container = document.querySelector('#myHandsomeTable');

    const hot = new Handsontable(container, {
    data: json_data,
    rowHeaders: true,
    colHeaders: labels,
    height: 'auto',
    licenseKey: 'non-commercial-and-evaluation' // for non-commercial use only
    });

    function saveAsPDF() {
        //html2canvas(document.getElementById("myChart"), {
        html2canvas(document.getElementById("myHandsomeTable"), {
            onrendered: function(canvas) {
                var img = canvas.toDataURL(); //image data of canvas
                var doc = new jsPDF('l', 'mm', [297, 210], true);         
                doc.addImage(img, 10, 10);
                doc.save('test.pdf');
                }
            });
    };

    let startInput = document.getElementById('begin');
    let endInput = document.getElementById('until');
    let messageDiv = document.getElementById('message');
    let submitButton = document.getElementById('submit');

    let compare = () => {
        let startValue = (new Date(startInput.value)).getTime();
        let endValue = (new Date(endInput.value)).getTime();

        if (endValue < startValue) {
        messageDiv.innerHTML = 'Fecha de inicio debe ser mas antigua que la del final!';
        submitButton.disabled = true;
        } else {
        messageDiv.innerHTML = '';
        submitButton.disabled = false;
        }
    };

    startInput.addEventListener('change', compare);
    endInput.addEventListener('change', compare);
    </script>
    
</body>
</html>

{% endblock %}