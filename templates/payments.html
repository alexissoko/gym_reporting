{% extends "base.html" %}

{% block content %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>charting python</title>
</head>
<body>
    <h3>
        {{_("Payments")}}
        <small class="text-muted">{{_("by clients")}}</small>
    </h3>
      
    <div class="container-fluid">
      
        <div class="row">
      
          <!-- filter sidebar -->
            <div id="filter-sidebar" class="col-xs-6 col-sm-3 visible-sm visible-md visible-lg collapse sliding-sidebar">

                <form method="GET">
                    <div id="group-1">
                        {% for k, v in sold_objs.items %}
                        <div class="form-check">
                            <label class="form-check-label">
                            <input type="checkbox" class="form-check-input" name="boxes" value="">{{ k }}
                            </label>
                        </div>    
                        {% endfor %}
                    </div>    
                    <button type="submit" class="btn btn-primary">Submit</button>
                </form>
            </div>
            <!-- table container -->
            <div class="col-sm-9">
        
                <div class="card">
                    <form method="GET">
                        <div class="date_query">
                            <label for="start">Begining:</label>
                            <input type="date" id="begin" name="begin" format= 'dd/mm/yyyy' startDate= '-3d'>
                            <label for="start">Until:</label>
                            <input type="date" id="until" name="until" format= 'dd/mm/yyyy' startDate= '-3d'>
                            <button type="submit" class="btn btn-primary">Apply</button>
                            <div id="message"></div>
                        </div>
                        
                    </form>
                    <br>
                    <div id="chart_teiner">
                        <div id="myHandsomeTable"></div>
                    </div>
                    <br>
                    <button onclick="saveAsPDF();" class="btn btn-primary">save as pdf</button>
                </div>

                <a href="{% url 'post_new' %}" class="top-menu" sizes="HeightxWidth|any"> 
                    {% include './icons/file-earmark-plus.svg' %}
                </a>
                <a href="{% url 'payment_search' %}" class="top-menu">
                    {% include './icons/search.svg' %}
                </a>
            </div>
        </div>
      
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.5/jspdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/handsontable/dist/handsontable.full.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/handsontable/dist/handsontable.full.min.css" />

    <script>
        
    const json_data = {{json_data|safe}};
    const labels = {{labels|safe}};
    const container = document.querySelector('#myHandsomeTable');

    const hot = new Handsontable(container, {
        data: json_data,
        rowHeaders: true,
        colHeaders: labels,
        filters: true,
        dropdownMenu: ['filter_by_condition', 'filter_action_bar'],
        height: 'auto',
        width: 'auto',
        licenseKey: 'non-commercial-and-evaluation' // for non-commercial use only
    });
    

    function saveAsPDF() {
        //html2canvas(document.getElementById("myChart"), {
        html2canvas(document.getElementById("chart_teiner"), {
            onrendered: function(canvas) {
                var img = canvas.toDataURL(); //image data of canvas
                var doc = new jsPDF('l', 'mm', [340, 280], true);         
                doc.addImage(img, 10, 10);
                doc.save('test.pdf');
                }
            });
    };
    </script>
    
</body>
</html>

<style>
    #container.handsontable table{
    width:100%;
}
</style>

{% endblock %}